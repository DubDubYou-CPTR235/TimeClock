<p id="notice"><%= notice %></p>

<h1>Listing Tasks</h1>

<table>
  <thead>
    <tr>
      <th>Task Name</th>
      <th>Project Name</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @tasks.each do |task| %>
    	<% ctask = TimeCard.find_by(user_id: current_user.id, task_id: task.id, clocked_in: 1) %>
      <tr>
        <td><%= task.name %></td>
        <td><%= Project.find(task.project_id).name %></td>
        <td>
        	<% if ctask %>
	        	<%= form_tag({controller: "time_cards", id: ctask.id, action: "update"}, {method: "patch"}) do %>
	        		<input type='hidden' name='time_card[clocked_in]' value='0'>
	        		<%= submit_tag("Clock Out") %>
	        	<% end %>
	        <% else %>
	        	<%= form_tag(controller: "time_cards", action: "create", method: "post") do %>
	        		<input type='hidden' name='time_card[task_id]' value='<%= task.id %>'>
              <input type='hidden' name='time_card[user_id]' value='<%= current_user.id %>'>
	        		<input type='hidden' name='time_card[clocked_in]' value='1'>
	        		<%= submit_tag(" Clock In ") %>
	        	<% end %>
	        <% end %>
        </td>
        <% if current_user.admin %>
        <td><%= link_to 'Edit', edit_task_path(task) %></td>
        <td><%= link_to 'Destroy', task, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if current_user.admin %>
	<%= link_to 'New Task', new_task_path %>
<% end %>

<%= link_to 'Sign Out', destroy_user_session_path, method: :delete %>



